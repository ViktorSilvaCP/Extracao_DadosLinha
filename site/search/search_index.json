{"config":{"lang":["pt"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"\ud83d\ude80 Sistema de Monitoramento PLC - CANPACK Brasil","text":"<ul> <li> <p> Tempo Real</p> <p>Monitoramento cont\u00ednuo das linhas de produ\u00e7\u00e3o Cupper_22 e Cupper_23 com atualiza\u00e7\u00e3o instant\u00e2nea de dados</p> <p> Ver Dashboard</p> </li> <li> <p> Hist\u00f3rico Completo</p> <p>Armazenamento autom\u00e1tico de toda produ\u00e7\u00e3o com rastreabilidade por lote, turno e bobina</p> <p> Consultar Relat\u00f3rios</p> </li> <li> <p> API REST</p> <p>Integra\u00e7\u00e3o facilitada com ERP TOTVS atrav\u00e9s de endpoints otimizados e documentados</p> <p> Ver API Docs</p> </li> <li> <p> Alta Confiabilidade</p> <p>Sistema robusto com backup autom\u00e1tico, fallback inteligente e recupera\u00e7\u00e3o de falhas</p> <p> Saiba Mais</p> </li> </ul>"},{"location":"#visao-geral","title":"Vis\u00e3o Geral","text":"<p>Este sistema de monitoramento industrial foi desenvolvido especificamente para a CANPACK Brasil, permitindo o controle completo do ciclo de vida das bobinas nas linhas de produ\u00e7\u00e3o de copos.</p>"},{"location":"#principais-funcionalidades","title":"Principais Funcionalidades","text":"MonitoramentoGest\u00e3o de LotesIntegra\u00e7\u00e3o ERP <ul> <li>\u2705 Conex\u00e3o em tempo real com PLCs via EtherNet/IP</li> <li>\u2705 Detec\u00e7\u00e3o autom\u00e1tica de troca de bobinas</li> <li>\u2705 C\u00e1lculo de produ\u00e7\u00e3o por turno (DIA/NOITE)</li> <li>\u2705 Identifica\u00e7\u00e3o de formato de copo por Feed Rate</li> <li>\u2705 Alertas autom\u00e1ticos por email</li> </ul> <ul> <li>\u2705 Interface web para inser\u00e7\u00e3o de c\u00f3digos de barras</li> <li>\u2705 Valida\u00e7\u00e3o de lotes com m\u00ednimo de 6 d\u00edgitos</li> <li>\u2705 Rastreamento de bobinas de entrada e sa\u00edda</li> <li>\u2705 Hist\u00f3rico completo de movimenta\u00e7\u00f5es</li> <li>\u2705 Notifica\u00e7\u00f5es de mudan\u00e7a de lote</li> </ul> <ul> <li>\u2705 Endpoint dedicado para TOTVS</li> <li>\u2705 Sincroniza\u00e7\u00e3o incremental via <code>since_id</code></li> <li>\u2705 Formato JSON padronizado</li> <li>\u2705 Health check para monitoramento</li> <li>\u2705 Documenta\u00e7\u00e3o OpenAPI/Swagger</li> </ul>"},{"location":"#inicio-rapido","title":"In\u00edcio R\u00e1pido","text":""},{"location":"#acessar-o-sistema","title":"Acessar o Sistema","text":"<pre><code># Interface Web\nhttp://10.81.5.219:15789\n\n# Documenta\u00e7\u00e3o Interativa (Swagger)\nhttp://10.81.5.219:15789/docs\n\n# Health Check\nhttp://10.81.5.219:15789/api/health\n</code></pre>"},{"location":"#exemplo-de-uso-da-api","title":"Exemplo de Uso da API","text":"PythonJavaScriptcURL <pre><code>import requests\n\n# Consultar status de uma linha\nresponse = requests.get('http://10.81.5.219:15789/api/lote/Cupper_22')\ndata = response.json()\n\nprint(f\"Lote Atual: {data['lote_atual']}\")\nprint(f\"Produ\u00e7\u00e3o: {data['producao_total_acumulada']} copos\")\n</code></pre> <pre><code>// Buscar dados de todas as linhas\nfetch('http://10.81.5.219:15789/api/lotes')\n  .then(response =&gt; response.json())\n  .then(data =&gt; {\n    console.log('Total de PLCs:', data.total_plcs);\n    console.log('Lotes:', data.lotes);\n  });\n</code></pre> <pre><code># Sincroniza\u00e7\u00e3o TOTVS\ncurl -X GET \"http://10.81.5.219:15789/api/totvs/producao?limit=50&amp;since_id=100\"\n</code></pre>"},{"location":"#arquitetura-do-sistema","title":"Arquitetura do Sistema","text":"<pre><code>graph LR\n    A[PLC Cupper_22] --&gt;|EtherNet/IP| B[Sistema Monitor]\n    C[PLC Cupper_23] --&gt;|EtherNet/IP| B\n    B --&gt; D[SQLite DB]\n    B --&gt; E[API REST]\n    E --&gt; F[Interface Web]\n    E --&gt; G[ERP TOTVS]\n    B --&gt; H[Email Alerts]\n</code></pre>"},{"location":"#tecnologias","title":"Tecnologias","text":"<p> Python 3.13</p> <p> FastAPI</p> <p> SQLite</p> <p> Pylogix</p>"},{"location":"#suporte","title":"Suporte","text":"<p>Contato T\u00e9cnico</p> <p>Respons\u00e1vel: Victor Nascimento Silva Email: victor.nascimento@canpack.com Departamento: Tecnologia - CANPACK Brasil</p> <p> Come\u00e7ar Agora  Ver API Docs</p>"},{"location":"about/","title":"Sobre o Sistema","text":""},{"location":"about/#informacoes-do-projeto","title":"Informa\u00e7\u00f5es do Projeto","text":"<p>Nome: Sistema de Monitoramento PLC - CANPACK Brasil Vers\u00e3o: 2.1.0 Desenvolvedor: Victor Nascimento Silva Empresa: CANPACK Brasil Departamento: Tecnologia  </p>"},{"location":"about/#historico-de-versoes","title":"Hist\u00f3rico de Vers\u00f5es","text":""},{"location":"about/#v210-janeiro-2026","title":"v2.1.0 (Janeiro 2026)","text":"<ul> <li>\u2705 Integra\u00e7\u00e3o com ERP TOTVS</li> <li>\u2705 Endpoint de Health Check</li> <li>\u2705 Sistema de backup autom\u00e1tico</li> <li>\u2705 Documenta\u00e7\u00e3o completa</li> <li>\u2705 Suporte a underscores nos nomes de m\u00e1quinas</li> </ul>"},{"location":"about/#v200-dezembro-2025","title":"v2.0.0 (Dezembro 2025)","text":"<ul> <li>\u2705 Refatora\u00e7\u00e3o completa da arquitetura</li> <li>\u2705 Migra\u00e7\u00e3o para estrutura modular (<code>src/</code>)</li> <li>\u2705 API REST com FastAPI</li> <li>\u2705 Documenta\u00e7\u00e3o Swagger/OpenAPI</li> <li>\u2705 Sistema de turnos aprimorado</li> </ul>"},{"location":"about/#v100-outubro-2025","title":"v1.0.0 (Outubro 2025)","text":"<ul> <li>\u2705 Vers\u00e3o inicial</li> <li>\u2705 Monitoramento b\u00e1sico de PLCs</li> <li>\u2705 Registro de produ\u00e7\u00e3o</li> </ul>"},{"location":"about/#contato","title":"Contato","text":""},{"location":"about/#suporte-tecnico","title":"Suporte T\u00e9cnico","text":"<p>Email: victor.nascimento@canpack.com Localiza\u00e7\u00e3o: CANPACK Brasil - Tecnologia  </p>"},{"location":"about/#reportar-problemas","title":"Reportar Problemas","text":"<p>Para reportar bugs ou solicitar funcionalidades:</p> <ol> <li>Envie email com:</li> <li>Descri\u00e7\u00e3o detalhada do problema</li> <li>Logs relevantes</li> <li>Passos para reproduzir</li> <li>Screenshots (se aplic\u00e1vel)</li> </ol>"},{"location":"about/#licenca","title":"Licen\u00e7a","text":"<p>\u00a9 2025-2026 CANPACK Group. Todos os direitos reservados.</p> <p>Este sistema \u00e9 propriedade da CANPACK Brasil e destina-se exclusivamente ao uso interno.</p>"},{"location":"api/endpoints/","title":"Refer\u00eancia de API","text":""},{"location":"api/endpoints/#endpoints-disponiveis","title":"Endpoints Dispon\u00edveis","text":"<p>O sistema oferece uma API REST completa com documenta\u00e7\u00e3o interativa dispon\u00edvel em:</p> <p>http://10.81.5.219:15789/docs </p>"},{"location":"api/endpoints/#monitoramento-em-tempo-real","title":"Monitoramento em Tempo Real","text":""},{"location":"api/endpoints/#status-individual-de-linha","title":"Status Individual de Linha","text":"<p>Retorna dados completos de uma linha espec\u00edfica.</p> <p>GET <code>/api/lote/{plc_name}</code></p> RequestResponse 200Response 404 <pre><code>GET /api/lote/Cupper_22 HTTP/1.1\nHost: 10.81.5.219:15789\nAccept: application/json\n</code></pre> <pre><code>{\n  \"lote_atual\": \"284043\",\n  \"tipo_bobina\": \"M\",\n  \"bobina_saida\": \"279254\",\n  \"data_bobina_saida\": \"06/10/2025 09:44:52\",\n  \"status_maquina\": \"ATIVO\",\n  \"status_bobina_plc\": \"Nenhuma Bobina Consumida\",\n  \"formato\": \"350ml_STD\",\n  \"feed_rate\": 5.5848,\n  \"producao_bobina\": 12500,\n  \"producao_total_acumulada\": 1250000,\n  \"turno_atual\": \"DIA (07-19)\",\n  \"ultima_atualizacao\": \"12/01/2026 14:30:00\",\n  \"conectado\": true\n}\n</code></pre> <pre><code>{\n  \"error\": \"M\u00e1quina n\u00e3o encontrada\"\n}\n</code></pre> <p>Par\u00e2metros:</p> Nome Tipo Descri\u00e7\u00e3o <code>plc_name</code> string Nome da m\u00e1quina (<code>Cupper_22</code> ou <code>Cupper_23</code>)"},{"location":"api/endpoints/#resumo-geral","title":"Resumo Geral","text":"<p>Retorna o status consolidado de todas as linhas.</p> <p>GET <code>/api/lotes</code></p> Response <pre><code>{\n  \"dados_plcs\": {\n    \"Cupper_22\": { /* dados completos */ },\n    \"Cupper_23\": { /* dados completos */ }\n  },\n  \"lotes\": {\n    \"Cupper_22\": \"284043\",\n    \"Cupper_23\": \"271435\"\n  },\n  \"timestamp\": \"12/01/2026 14:30:00\",\n  \"total_plcs\": 2\n}\n</code></pre>"},{"location":"api/endpoints/#relatorios-de-producao","title":"Relat\u00f3rios de Produ\u00e7\u00e3o","text":""},{"location":"api/endpoints/#producao-por-turno","title":"Produ\u00e7\u00e3o por Turno","text":"<p>Consolida a produ\u00e7\u00e3o total agrupada por turno e linha.</p> <p>GET <code>/api/producao/turno</code></p> <p>Query Parameters:</p> Nome Tipo Obrigat\u00f3rio Descri\u00e7\u00e3o <code>machine_name</code> string N\u00e3o Filtrar por m\u00e1quina espec\u00edfica Response <pre><code>[\n  {\n    \"machine_name\": \"Cupper_22\",\n    \"shift\": \"DIA (07-19)\",\n    \"coil_number\": \"284043\",\n    \"total\": 125000,\n    \"last_update\": \"2026-01-12 14:30:00\"\n  },\n  {\n    \"machine_name\": \"Cupper_22\",\n    \"shift\": \"NOITE (19-07)\",\n    \"coil_number\": \"284043\",\n    \"total\": 98000,\n    \"last_update\": \"2026-01-12 02:15:00\"\n  }\n]\n</code></pre>"},{"location":"api/endpoints/#producao-por-lote","title":"Produ\u00e7\u00e3o por Lote","text":"<p>Hist\u00f3rico detalhado de cada bobina processada.</p> <p>GET <code>/api/producao/lote</code></p> <p>Query Parameters:</p> Nome Tipo Obrigat\u00f3rio Descri\u00e7\u00e3o <code>machine_name</code> string N\u00e3o Filtrar por m\u00e1quina espec\u00edfica Response <pre><code>[\n  {\n    \"machine_name\": \"Cupper_22\",\n    \"coil_number\": \"284043\",\n    \"shift\": \"DIA (07-19)\",\n    \"total\": 223000,\n    \"start_time\": \"2026-01-12 07:00:00\",\n    \"end_time\": \"2026-01-12 14:30:00\"\n  }\n]\n</code></pre>"},{"location":"api/endpoints/#integracao-erp-totvs","title":"Integra\u00e7\u00e3o ERP (TOTVS)","text":""},{"location":"api/endpoints/#sincronizacao-de-producao","title":"Sincroniza\u00e7\u00e3o de Produ\u00e7\u00e3o","text":"<p>Endpoint otimizado para consumo pelo ERP com suporte a sincroniza\u00e7\u00e3o incremental.</p> <p>GET <code>/api/totvs/producao</code></p> <p>Query Parameters:</p> Nome Tipo Default Descri\u00e7\u00e3o <code>limit</code> integer 100 Quantidade m\u00e1xima de registros <code>since_id</code> integer null ID do \u00faltimo registro sincronizado RequestResponse <pre><code>GET /api/totvs/producao?limit=50&amp;since_id=1234 HTTP/1.1\nHost: 10.81.5.219:15789\n</code></pre> <pre><code>{\n  \"count\": 50,\n  \"results\": [\n    {\n      \"id\": 1235,\n      \"timestamp\": \"2026-01-12 14:30:00\",\n      \"machine_name\": \"Cupper_22\",\n      \"coil_number\": \"284043\",\n      \"cups_produced\": 12500,\n      \"consumption_type\": \"Baixa Completa\",\n      \"shift\": \"DIA (07-19)\"\n    }\n  ],\n  \"timestamp\": \"2026-01-12 14:35:00\"\n}\n</code></pre> <p>Sincroniza\u00e7\u00e3o Incremental</p> <p>Para evitar duplica\u00e7\u00e3o de dados, o TOTVS deve:</p> <ol> <li>Armazenar o <code>id</code> do \u00faltimo registro processado</li> <li>Na pr\u00f3xima consulta, usar <code>since_id={ultimo_id}</code></li> <li>Processar apenas os novos registros retornados</li> </ol>"},{"location":"api/endpoints/#health-check","title":"Health Check","text":""},{"location":"api/endpoints/#verificacao-de-saude","title":"Verifica\u00e7\u00e3o de Sa\u00fade","text":"<p>Monitora o status do sistema e conectividade dos PLCs.</p> <p>GET <code>/api/health</code></p> Response (Tudo OK)Response (Com Problemas) <pre><code>{\n  \"status\": \"OK\",\n  \"database\": \"CONNECTED\",\n  \"plcs\": {\n    \"Cupper_22\": \"ONLINE\",\n    \"Cupper_23\": \"ONLINE\"\n  },\n  \"timestamp\": \"2026-01-12 14:30:00\"\n}\n</code></pre> <pre><code>{\n  \"status\": \"OK\",\n  \"database\": \"CONNECTED\",\n  \"plcs\": {\n    \"Cupper_22\": \"OFFLINE\",\n    \"Cupper_23\": \"ONLINE\"\n  },\n  \"timestamp\": \"2026-01-12 14:30:00\"\n}\n</code></pre> <p>Monitoramento Proativo</p> <p>Recomenda-se configurar uma ferramenta de monitoramento (como Grafana ou Zabbix) para consultar este endpoint a cada 30 segundos e alertar em caso de falhas.</p>"},{"location":"api/endpoints/#operacao-de-lotes","title":"Opera\u00e7\u00e3o de Lotes","text":""},{"location":"api/endpoints/#inserir-novo-lote","title":"Inserir Novo Lote","text":"<p>Interface para input manual de c\u00f3digos de lote via formul\u00e1rio web.</p> <p>POST <code>/enviar_lote</code></p> <p>Form Data:</p> Campo Tipo Valida\u00e7\u00e3o Descri\u00e7\u00e3o <code>lote</code> string Min 3 chars C\u00f3digo do lote <code>plc</code> string Required <code>Cupper_22</code> ou <code>Cupper_23</code> <code>tipo_bobina</code> string Required Espessura (L1, L2, L3, M, H1, H2, H3) RequestResponse 200Response 400 <pre><code>POST /enviar_lote HTTP/1.1\nHost: 10.81.5.219:15789\nContent-Type: application/x-www-form-urlencoded\n\nlote=284043&amp;plc=Cupper_22&amp;tipo_bobina=M\n</code></pre> <pre><code>Lote 284043 processado com sucesso para Cupper_22.\n</code></pre> <pre><code>{\n  \"detail\": \"O c\u00f3digo do lote deve ter pelo menos 3 caracteres.\"\n}\n</code></pre>"},{"location":"api/endpoints/#codigos-de-status-http","title":"C\u00f3digos de Status HTTP","text":"C\u00f3digo Significado Quando Ocorre 200 OK Requisi\u00e7\u00e3o bem-sucedida 400 Bad Request Par\u00e2metros inv\u00e1lidos 404 Not Found Recurso n\u00e3o encontrado 500 Internal Server Error Erro no servidor"},{"location":"api/endpoints/#rate-limiting","title":"Rate Limiting","text":"<p>Sem Limita\u00e7\u00e3o Atual</p> <p>Atualmente o sistema n\u00e3o possui rate limiting. Para uso em produ\u00e7\u00e3o com o TOTVS, recomenda-se:</p> <ul> <li>Consultas a cada 5-10 segundos para dados em tempo real</li> <li>Sincroniza\u00e7\u00e3o a cada 1 minuto para hist\u00f3rico</li> <li>Health check a cada 30 segundos</li> </ul>"},{"location":"api/totvs/","title":"Integra\u00e7\u00e3o com TOTVS","text":"<p>Este guia detalha como integrar o sistema de monitoramento PLC com o ERP TOTVS.</p>"},{"location":"api/totvs/#visao-geral-da-integracao","title":"Vis\u00e3o Geral da Integra\u00e7\u00e3o","text":"<p>O sistema oferece um endpoint dedicado (<code>/api/totvs/producao</code>) otimizado para sincroniza\u00e7\u00e3o com o TOTVS, permitindo:</p> <ul> <li>\u2705 Sincroniza\u00e7\u00e3o Incremental: Buscar apenas registros novos</li> <li>\u2705 Controle de Volume: Limitar quantidade de registros por requisi\u00e7\u00e3o</li> <li>\u2705 Rastreabilidade: Cada registro possui ID \u00fanico sequencial</li> <li>\u2705 Formato Padronizado: JSON compat\u00edvel com REST APIs</li> </ul>"},{"location":"api/totvs/#fluxo-de-integracao","title":"Fluxo de Integra\u00e7\u00e3o","text":"<pre><code>sequenceDiagram\n    participant TOTVS\n    participant API\n    participant DB as SQLite\n\n    TOTVS-&gt;&gt;API: GET /api/totvs/producao?since_id=0\n    API-&gt;&gt;DB: SELECT * WHERE id &gt; 0 LIMIT 100\n    DB--&gt;&gt;API: Registros 1-100\n    API--&gt;&gt;TOTVS: JSON com 100 registros\n\n    Note over TOTVS: Armazena \u00faltimo ID = 100\n\n    TOTVS-&gt;&gt;API: GET /api/totvs/producao?since_id=100\n    API-&gt;&gt;DB: SELECT * WHERE id &gt; 100 LIMIT 100\n    DB--&gt;&gt;API: Registros 101-150\n    API--&gt;&gt;TOTVS: JSON com 50 registros\n</code></pre>"},{"location":"api/totvs/#estrutura-de-dados","title":"Estrutura de Dados","text":""},{"location":"api/totvs/#registro-de-producao","title":"Registro de Produ\u00e7\u00e3o","text":"<p>Cada registro retornado cont\u00e9m:</p> <pre><code>{\n  \"id\": 1235,                           // ID \u00fanico sequencial\n  \"timestamp\": \"2026-01-12 14:30:00\",   // Data/hora da produ\u00e7\u00e3o\n  \"machine_name\": \"Cupper_22\",          // Linha de produ\u00e7\u00e3o\n  \"coil_number\": \"284043\",              // N\u00famero do lote/bobina\n  \"cups_produced\": 12500,               // Quantidade produzida\n  \"consumption_type\": \"Baixa Completa\", // Tipo de consumo\n  \"shift\": \"DIA (07-19)\"                // Turno\n}\n</code></pre>"},{"location":"api/totvs/#mapeamento-para-totvs","title":"Mapeamento para TOTVS","text":"<p>Sugest\u00e3o de mapeamento para tabelas do TOTVS:</p> Campo API Tabela TOTVS Campo TOTVS Observa\u00e7\u00f5es <code>id</code> - - Usar para controle de sincroniza\u00e7\u00e3o <code>timestamp</code> <code>SC2</code> (OP) <code>C2_DATPRF</code> Data de produ\u00e7\u00e3o <code>machine_name</code> <code>SH1</code> (Recurso) <code>H1_CODIGO</code> C\u00f3digo do recurso <code>coil_number</code> <code>SC2</code> <code>C2_NUM</code> N\u00famero da OP <code>cups_produced</code> <code>SC2</code> <code>C2_QUANT</code> Quantidade produzida <code>shift</code> <code>SH6</code> (Turno) <code>H6_CODIGO</code> C\u00f3digo do turno"},{"location":"api/totvs/#implementacao-no-totvs","title":"Implementa\u00e7\u00e3o no TOTVS","text":""},{"location":"api/totvs/#1-configuracao-inicial","title":"1. Configura\u00e7\u00e3o Inicial","text":"<p>No TOTVS, crie uma tabela customizada para controlar a sincroniza\u00e7\u00e3o:</p> <pre><code>CREATE TABLE ZZ_SYNC_PLC (\n    ZZ_TABELA VARCHAR(10),     -- Nome da tabela sincronizada\n    ZZ_ULTIMO_ID INTEGER,      -- \u00daltimo ID sincronizado\n    ZZ_DATA DATETIME,          -- Data da \u00faltima sincroniza\u00e7\u00e3o\n    ZZ_STATUS VARCHAR(1)       -- Status (A=Ativo, E=Erro)\n)\n</code></pre>"},{"location":"api/totvs/#2-rotina-de-sincronizacao-advpl","title":"2. Rotina de Sincroniza\u00e7\u00e3o (AdvPL)","text":"<pre><code>#Include \"Protheus.ch\"\n#Include \"RestFul.ch\"\n\n/*/{Protheus.doc} SYNCPLC\nSincroniza dados de produ\u00e7\u00e3o do sistema PLC\n@type function\n@author Victor Nascimento\n@since 12/01/2026\n/*/\nUser Function SYNCPLC()\n    Local cUrl := \"http://10.81.5.219:15789/api/totvs/producao\"\n    Local nUltimoId := GetUltimoId()\n    Local oRest := FWRest():New(cUrl)\n    Local cResponse := \"\"\n    Local oJson\n    Local nI\n\n    // Adiciona par\u00e2metros\n    oRest:SetPath(cUrl + \"?limit=100&amp;since_id=\" + cValToChar(nUltimoId))\n\n    // Executa requisi\u00e7\u00e3o\n    If oRest:Get()\n        cResponse := oRest:GetResult()\n        oJson := JsonObject():New()\n        oJson:FromJson(cResponse)\n\n        // Processa cada registro\n        For nI := 1 To Len(oJson:results)\n            ProcessaRegistro(oJson:results[nI])\n        Next nI\n\n        // Atualiza \u00faltimo ID\n        If Len(oJson:results) &gt; 0\n            AtualizaUltimoId(oJson:results[Len(oJson:results)]:id)\n        EndIf\n\n        ConOut(\"[SYNCPLC] Sincronizados \" + cValToChar(oJson:count) + \" registros\")\n    Else\n        ConOut(\"[SYNCPLC] Erro: \" + oRest:GetLastError())\n    EndIf\n\nReturn\n\nStatic Function GetUltimoId()\n    Local cQuery := \"\"\n    Local nId := 0\n\n    cQuery := \"SELECT ZZ_ULTIMO_ID FROM \" + RetSqlName(\"ZZ_SYNC_PLC\")\n    cQuery += \" WHERE ZZ_TABELA = 'PLC_PROD' AND D_E_L_E_T_ = ' '\"\n\n    cQuery := ChangeQuery(cQuery)\n    dbUseArea(.T., \"TOPCONN\", TCGenQry(,,cQuery), \"TMP\", .F., .T.)\n\n    If !TMP-&gt;(Eof())\n        nId := TMP-&gt;ZZ_ULTIMO_ID\n    EndIf\n\n    TMP-&gt;(DbCloseArea())\n\nReturn nId\n\nStatic Function ProcessaRegistro(oReg)\n    // Implementar l\u00f3gica de grava\u00e7\u00e3o na SC2, SH1, etc.\n    // Exemplo simplificado:\n\n    RecLock(\"SC2\", .T.)\n    SC2-&gt;C2_FILIAL  := xFilial(\"SC2\")\n    SC2-&gt;C2_NUM     := oReg:coil_number\n    SC2-&gt;C2_QUANT   := oReg:cups_produced\n    SC2-&gt;C2_DATPRF  := CtoD(SubStr(oReg:timestamp, 1, 10))\n    SC2-&gt;C2_RECURSO := IIf(oReg:machine_name == \"Cupper_22\", \"REC001\", \"REC002\")\n    MsUnlock()\n\nReturn\n\nStatic Function AtualizaUltimoId(nNovoId)\n    dbSelectArea(\"ZZ_SYNC_PLC\")\n    RecLock(\"ZZ_SYNC_PLC\", .F.)\n    ZZ_SYNC_PLC-&gt;ZZ_ULTIMO_ID := nNovoId\n    ZZ_SYNC_PLC-&gt;ZZ_DATA := DateTime()\n    MsUnlock()\nReturn\n</code></pre>"},{"location":"api/totvs/#3-agendamento","title":"3. Agendamento","text":"<p>Configure o Job Scheduler do TOTVS para executar a rotina:</p> <ul> <li>Frequ\u00eancia: A cada 5 minutos</li> <li>Hor\u00e1rio: 24/7</li> <li>Fun\u00e7\u00e3o: <code>U_SYNCPLC</code></li> </ul>"},{"location":"api/totvs/#tratamento-de-erros","title":"Tratamento de Erros","text":""},{"location":"api/totvs/#cenarios-comuns","title":"Cen\u00e1rios Comuns","text":"<p>Sistema PLC Offline</p> <p>Sintoma: Timeout na requisi\u00e7\u00e3o HTTP</p> <p>Solu\u00e7\u00e3o: <pre><code>If !oRest:Get()\n    // Registrar erro no log\n    ConOut(\"[SYNCPLC] Sistema PLC offline\")\n    // Enviar email para TI\n    U_EnviaAlerta(\"PLC Offline\", oRest:GetLastError())\n    // Aguardar pr\u00f3xima execu\u00e7\u00e3o\n    Return\nEndIf\n</code></pre></p> <p>Dados Duplicados</p> <p>Sintoma: Registros com mesmo ID sendo processados</p> <p>Solu\u00e7\u00e3o: Implementar verifica\u00e7\u00e3o antes de gravar: <pre><code>dbSelectArea(\"SC2\")\ndbSetOrder(1) // C2_FILIAL + C2_NUM\nIf !dbSeek(xFilial(\"SC2\") + oReg:coil_number)\n    // Gravar apenas se n\u00e3o existir\n    RecLock(\"SC2\", .T.)\n    // ...\nEndIf\n</code></pre></p>"},{"location":"api/totvs/#monitoramento","title":"Monitoramento","text":""},{"location":"api/totvs/#dashboard-de-sincronizacao","title":"Dashboard de Sincroniza\u00e7\u00e3o","text":"<p>Crie uma consulta SQL no TOTVS para monitorar:</p> <pre><code>SELECT \n    ZZ_TABELA AS 'Tabela',\n    ZZ_ULTIMO_ID AS '\u00daltimo ID',\n    ZZ_DATA AS '\u00daltima Sync',\n    DATEDIFF(MINUTE, ZZ_DATA, GETDATE()) AS 'Minutos Atr\u00e1s',\n    ZZ_STATUS AS 'Status'\nFROM ZZ_SYNC_PLC\nWHERE D_E_L_E_T_ = ' '\n</code></pre>"},{"location":"api/totvs/#alertas-recomendados","title":"Alertas Recomendados","text":"<p>Configure alertas para:</p> <ul> <li>\u26a0\ufe0f Sincroniza\u00e7\u00e3o parada h\u00e1 mais de 10 minutos</li> <li>\u26a0\ufe0f Erros consecutivos (3+)</li> <li>\u26a0\ufe0f Diferen\u00e7a grande entre \u00faltimo ID local e remoto</li> </ul>"},{"location":"api/totvs/#health-check","title":"Health Check","text":"<p>Use o endpoint <code>/api/health</code> para verificar se o sistema est\u00e1 operacional antes de sincronizar:</p> <pre><code>User Function CheckPLC()\n    Local oRest := FWRest():New(\"http://10.81.5.219:15789/api/health\")\n    Local oJson\n\n    If oRest:Get()\n        oJson := JsonObject():New()\n        oJson:FromJson(oRest:GetResult())\n\n        If oJson:status == \"OK\"\n            Return .T.\n        EndIf\n    EndIf\n\nReturn .F.\n</code></pre>"},{"location":"api/totvs/#boas-praticas","title":"Boas Pr\u00e1ticas","text":"<p>Performance</p> <ul> <li>Use <code>limit=100</code> para evitar timeouts</li> <li>Execute a sincroniza\u00e7\u00e3o fora do hor\u00e1rio de pico</li> <li>Implemente cache local se necess\u00e1rio</li> </ul> <p>Seguran\u00e7a</p> <ul> <li>Configure firewall para permitir apenas IP do servidor TOTVS</li> <li>Considere implementar autentica\u00e7\u00e3o via API Key</li> <li>Use HTTPS em produ\u00e7\u00e3o</li> </ul> <p>Auditoria</p> <ul> <li>Registre todas as sincroniza\u00e7\u00f5es em log</li> <li>Mantenha hist\u00f3rico de erros</li> <li>Monitore volume de dados transferidos</li> </ul>"},{"location":"api/totvs/#suporte","title":"Suporte","text":"<p>Para d\u00favidas sobre a integra\u00e7\u00e3o, contate:</p> <p>Victor Nascimento Email: victor.nascimento@canpack.com</p>"},{"location":"guide/installation/","title":"Guia de Instala\u00e7\u00e3o","text":"<p>Este guia detalha como instalar e configurar o Sistema de Monitoramento PLC.</p>"},{"location":"guide/installation/#pre-requisitos","title":"Pr\u00e9-requisitos","text":""},{"location":"guide/installation/#software-necessario","title":"Software Necess\u00e1rio","text":"<ul> <li>[x] Python 3.13+ - Download</li> <li>[x] Git (opcional) - Para versionamento</li> <li>[x] NSSM (opcional) - Para executar como servi\u00e7o Windows</li> </ul>"},{"location":"guide/installation/#requisitos-de-rede","title":"Requisitos de Rede","text":"<ul> <li>Acesso \u00e0 rede industrial (10.81.x.x)</li> <li>Conectividade com PLCs nas portas EtherNet/IP</li> <li>Porta 15789 dispon\u00edvel para o servidor web</li> </ul>"},{"location":"guide/installation/#instalacao-rapida","title":"Instala\u00e7\u00e3o R\u00e1pida","text":""},{"location":"guide/installation/#1-clonar-ou-baixar-o-projeto","title":"1. Clonar ou Baixar o Projeto","text":"<pre><code># Op\u00e7\u00e3o 1: Via Git\ngit clone &lt;repository-url&gt;\ncd Extracao_DadosLinha\n\n# Op\u00e7\u00e3o 2: Download manual\n# Extrair o ZIP para C:\\programs\\Extracao_DadosLinha\n</code></pre>"},{"location":"guide/installation/#2-instalar-dependencias","title":"2. Instalar Depend\u00eancias","text":"<pre><code># Instalar pacotes Python\npip install -r requirements.txt\n</code></pre> requirements.txt <pre><code>fastapi==0.109.0\nuvicorn[standard]==0.27.0\npylogix==0.8.4\npydantic==2.5.3\npython-multipart==0.0.6\njinja2==3.1.3\n</code></pre>"},{"location":"guide/installation/#3-configurar-plcs","title":"3. Configurar PLCs","text":"<p>Edite os arquivos de configura\u00e7\u00e3o para cada m\u00e1quina:</p> Cupper_22/config.jsonCupper_23/config.json <pre><code>{\n  \"plc_config\": {\n    \"ip_address\": \"10.81.71.11\",\n    \"processor_slot\": 4\n  },\n  \"production_config\": {\n    \"size_data_dir\": \"production_data/Cupper_22\"\n  }\n}\n</code></pre> <pre><code>{\n  \"plc_config\": {\n    \"ip_address\": \"10.81.72.11\",\n    \"processor_slot\": 4\n  },\n  \"production_config\": {\n    \"size_data_dir\": \"production_data/Cupper_23\"\n  }\n}\n</code></pre>"},{"location":"guide/installation/#4-executar-o-sistema","title":"4. Executar o Sistema","text":"<pre><code>python app.py\n</code></pre> <p>Acesse: http://10.81.5.219:15789</p>"},{"location":"guide/installation/#instalacao-como-servico-windows","title":"Instala\u00e7\u00e3o como Servi\u00e7o Windows","text":"<p>Para garantir que o sistema inicie automaticamente com o Windows:</p>"},{"location":"guide/installation/#1-baixar-nssm","title":"1. Baixar NSSM","text":"<ol> <li>Acesse nssm.cc</li> <li>Baixe a vers\u00e3o 64-bit</li> <li>Extraia <code>nssm.exe</code> para <code>C:\\nssm\\</code></li> </ol>"},{"location":"guide/installation/#2-instalar-o-servico","title":"2. Instalar o Servi\u00e7o","text":"<p>Abra o PowerShell como Administrador:</p> <pre><code># Navegar at\u00e9 o diret\u00f3rio do NSSM\ncd C:\\nssm\n\n# Instalar o servi\u00e7o\n.\\nssm.exe install CanpackPLCMonitor\n</code></pre>"},{"location":"guide/installation/#3-configurar-o-servico","title":"3. Configurar o Servi\u00e7o","text":"<p>Na janela que abrir, configure:</p> Campo Valor Path <code>C:\\Python313\\python.exe</code> Startup directory <code>C:\\programs\\Extracao_DadosLinha</code> Arguments <code>app.py</code> <p>Aba \"Details\":</p> Campo Valor Display name Sistema de Monitoramento PLC - CANPACK Description Monitoramento em tempo real das linhas Cupper Startup type Automatic"},{"location":"guide/installation/#4-configurar-recuperacao","title":"4. Configurar Recupera\u00e7\u00e3o","text":"<p>Aba \"Exit Actions\":</p> <ul> <li>Restart application</li> <li>Delay: 10000 ms</li> </ul> <p>Aba \"I/O\":</p> <ul> <li>Output (stdout): <code>C:\\programs\\Extracao_DadosLinha\\logs\\service_output.log</code></li> <li>Error (stderr): <code>C:\\programs\\Extracao_DadosLinha\\logs\\service_error.log</code></li> </ul>"},{"location":"guide/installation/#5-iniciar-o-servico","title":"5. Iniciar o Servi\u00e7o","text":"<pre><code># Iniciar\n.\\nssm.exe start CanpackPLCMonitor\n\n# Verificar status\n.\\nssm.exe status CanpackPLCMonitor\n\n# Parar (se necess\u00e1rio)\n.\\nssm.exe stop CanpackPLCMonitor\n</code></pre>"},{"location":"guide/installation/#verificacao-da-instalacao","title":"Verifica\u00e7\u00e3o da Instala\u00e7\u00e3o","text":""},{"location":"guide/installation/#1-health-check","title":"1. Health Check","text":"<pre><code>curl http://10.81.5.219:15789/api/health\n</code></pre> <p>Resposta esperada: <pre><code>{\n  \"status\": \"OK\",\n  \"database\": \"CONNECTED\",\n  \"plcs\": {\n    \"Cupper_22\": \"ONLINE\",\n    \"Cupper_23\": \"ONLINE\"\n  }\n}\n</code></pre></p>"},{"location":"guide/installation/#2-verificar-logs","title":"2. Verificar Logs","text":"<pre><code># Ver \u00faltimas 20 linhas do log\nGet-Content logs\\plc_system_20260112.log -Tail 20\n</code></pre>"},{"location":"guide/installation/#3-testar-interface-web","title":"3. Testar Interface Web","text":"<p>Acesse no navegador:</p> <ul> <li>Interface principal: http://10.81.5.219:15789</li> <li>Documenta\u00e7\u00e3o API: http://10.81.5.219:15789/docs</li> </ul>"},{"location":"guide/installation/#estrutura-de-diretorios","title":"Estrutura de Diret\u00f3rios","text":"<p>Ap\u00f3s a instala\u00e7\u00e3o, a estrutura ser\u00e1:</p> <pre><code>Extracao_DadosLinha/\n\u251c\u2500\u2500 app.py                  # Aplica\u00e7\u00e3o principal\n\u251c\u2500\u2500 src/                    # C\u00f3digo modular\n\u2502   \u251c\u2500\u2500 api_routes.py\n\u2502   \u251c\u2500\u2500 database_handler.py\n\u2502   \u251c\u2500\u2500 plc_manager.py\n\u2502   \u2514\u2500\u2500 ...\n\u251c\u2500\u2500 Cupper_22/             # Configura\u00e7\u00e3o Linha 22\n\u2502   \u2514\u2500\u2500 config.json\n\u251c\u2500\u2500 Cupper_23/             # Configura\u00e7\u00e3o Linha 23\n\u2502   \u2514\u2500\u2500 config.json\n\u251c\u2500\u2500 production_data/       # Dados de produ\u00e7\u00e3o\n\u2502   \u251c\u2500\u2500 Cupper_22/\n\u2502   \u2514\u2500\u2500 Cupper_23/\n\u251c\u2500\u2500 backups/               # Backups autom\u00e1ticos\n\u251c\u2500\u2500 logs/                  # Logs do sistema\n\u2514\u2500\u2500 production_data.db     # Banco de dados SQLite\n</code></pre>"},{"location":"guide/installation/#troubleshooting","title":"Troubleshooting","text":""},{"location":"guide/installation/#erro-modulenotfounderror","title":"Erro: \"ModuleNotFoundError\"","text":"<pre><code># Reinstalar depend\u00eancias\npip install -r requirements.txt --force-reinstall\n</code></pre>"},{"location":"guide/installation/#erro-address-already-in-use","title":"Erro: \"Address already in use\"","text":"<p>Outro processo est\u00e1 usando a porta 15789:</p> <pre><code># Encontrar processo\nnetstat -ano | findstr :15789\n\n# Matar processo (substitua PID)\ntaskkill /PID &lt;PID&gt; /F\n</code></pre>"},{"location":"guide/installation/#plcs-aparecem-como-offline","title":"PLCs aparecem como OFFLINE","text":"<ol> <li> <p>Verificar conectividade de rede:    <pre><code>ping 10.81.71.11\nping 10.81.72.11\n</code></pre></p> </li> <li> <p>Verificar IPs nos arquivos de configura\u00e7\u00e3o</p> </li> <li> <p>Verificar firewall do Windows</p> </li> </ol>"},{"location":"guide/installation/#proximos-passos","title":"Pr\u00f3ximos Passos","text":"<ul> <li>Configura\u00e7\u00e3o Avan\u00e7ada</li> <li>Refer\u00eancia de API</li> <li>Integra\u00e7\u00e3o TOTVS</li> </ul>"},{"location":"guide/overview/","title":"Vis\u00e3o Geral do Sistema","text":""},{"location":"guide/overview/#introducao","title":"Introdu\u00e7\u00e3o","text":"<p>O Sistema de Monitoramento PLC \u00e9 uma solu\u00e7\u00e3o completa para controle de produ\u00e7\u00e3o industrial desenvolvida especificamente para as linhas Cupper da CANPACK Brasil.</p>"},{"location":"guide/overview/#arquitetura","title":"Arquitetura","text":""},{"location":"guide/overview/#componentes-principais","title":"Componentes Principais","text":"<pre><code>graph TB\n    A[PLCs ControlLogix] --&gt;|EtherNet/IP| B[Monitor Python]\n    B --&gt; C[SQLite Database]\n    B --&gt; D[FastAPI Server]\n    D --&gt; E[Web Interface]\n    D --&gt; F[REST API]\n    F --&gt; G[ERP TOTVS]\n    B --&gt; H[Email Notifications]\n</code></pre>"},{"location":"guide/overview/#fluxo-de-dados","title":"Fluxo de Dados","text":"<ol> <li>Coleta: Sistema monitora tags dos PLCs via Pylogix</li> <li>Processamento: Detecta eventos (troca de bobina, mudan\u00e7a de formato)</li> <li>Armazenamento: Registra no SQLite com timestamp e turno</li> <li>Disponibiliza\u00e7\u00e3o: Exp\u00f5e via API REST para consumo</li> <li>Notifica\u00e7\u00e3o: Envia alertas por email quando necess\u00e1rio</li> </ol>"},{"location":"guide/overview/#funcionalidades","title":"Funcionalidades","text":""},{"location":"guide/overview/#monitoramento-em-tempo-real","title":"Monitoramento em Tempo Real","text":"<ul> <li>\u2705 Conex\u00e3o cont\u00ednua com PLCs via EtherNet/IP</li> <li>\u2705 Leitura de tags a cada 1 segundo</li> <li>\u2705 Detec\u00e7\u00e3o autom\u00e1tica de desconex\u00e3o</li> <li>\u2705 Reconex\u00e3o autom\u00e1tica com backoff exponencial</li> </ul>"},{"location":"guide/overview/#gestao-de-lotes","title":"Gest\u00e3o de Lotes","text":"<ul> <li>\u2705 Interface web para inser\u00e7\u00e3o de c\u00f3digos de barras</li> <li>\u2705 Valida\u00e7\u00e3o de formato (m\u00ednimo 6 d\u00edgitos)</li> <li>\u2705 Rastreamento de bobinas de entrada/sa\u00edda</li> <li>\u2705 Hist\u00f3rico completo de movimenta\u00e7\u00f5es</li> </ul>"},{"location":"guide/overview/#calculo-de-turnos","title":"C\u00e1lculo de Turnos","text":"<p>O sistema utiliza a seguinte regra:</p> Turno Hor\u00e1rio DIA 07:00 - 18:59 NOITE 19:00 - 06:59"},{"location":"guide/overview/#identificacao-de-formato","title":"Identifica\u00e7\u00e3o de Formato","text":"<p>Baseado no valor de <code>Feed_Progression_INCH</code>:</p> Formato Feed Rate Toler\u00e2ncia 269ml_FIT 5.1312 \u00b10.0004 350ml_STD 5.5848 \u00b10.0004 473ml 6.0768 \u00b10.0004 550ml 6.4304 \u00b10.0004"},{"location":"guide/overview/#tecnologias-utilizadas","title":"Tecnologias Utilizadas","text":""},{"location":"guide/overview/#backend","title":"Backend","text":"<ul> <li>FastAPI - Framework web moderno e r\u00e1pido</li> <li>Uvicorn - Servidor ASGI de alta performance</li> <li>Pylogix - Comunica\u00e7\u00e3o com PLCs Allen-Bradley</li> <li>SQLite - Banco de dados embutido</li> </ul>"},{"location":"guide/overview/#frontend","title":"Frontend","text":"<ul> <li>HTML5/CSS3 - Interface responsiva</li> <li>JavaScript - Interatividade</li> <li>TailwindCSS - Estiliza\u00e7\u00e3o moderna</li> </ul>"},{"location":"guide/overview/#infraestrutura","title":"Infraestrutura","text":"<ul> <li>Python 3.13 - Linguagem base</li> <li>NSSM - Execu\u00e7\u00e3o como servi\u00e7o Windows</li> <li>Git - Controle de vers\u00e3o</li> </ul>"},{"location":"guide/overview/#proximos-passos","title":"Pr\u00f3ximos Passos","text":"<ul> <li>Instala\u00e7\u00e3o</li> <li>Configura\u00e7\u00e3o</li> <li>API Reference</li> </ul>"}]}